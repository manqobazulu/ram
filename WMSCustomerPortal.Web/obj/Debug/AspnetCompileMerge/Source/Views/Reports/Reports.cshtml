
@{
    ViewBag.Title = "View";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="row">
    <div class="col-lg-12">
        <h1 class="WMS Reporting"></h1>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">

            <div class="panel-body">
                <form role="form">
                    <div class="row"></div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label id="labelName">From</label>
                            <div class='input-group date' id='datetimepickerPODate'>
                                <input type="text" id="txtDateFrom" name="txtDateFrom" placeholder="From:" class="form-control datePickerFilter" data-date-format="yyyy-mm-dd" />
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label id="labelName">To:</label>
                            <div class='input-group date' id='datetimepickerPODate'>
                                <input type="text" id="txtDateTo" name="txtDateTo" placeholder="To:" class="form-control datePickerFilter" data-date-format="yyyy-mm-dd" />
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Report Type:</label>
                            <select id="ReportList" class="form-control">
                                <option selected="selected">Please Select Report</option>
                                <option>Dispatched</option>
                                <option>IGDs</option>
                                <option>Received</option>
                                <option>StockOnHand</option>
                                <option>ReturnReceipt</option>
                            </select>
      
                        </div>
                    </div>

                    <div class="row"></div>
                </form>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <div class="col-lg-12">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Results
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="dataTable_wrapper" style="overflow:scroll;">
                            <table class="table table-bordered table-hover table-striped" id="StockOnHandReports">
                                <thead>
                                    <tr>
                                        <th style="width:100px;">Product Code</th>
                                        <th style="width:100px;">EAN Code</th>
                                        <th style="width:150px;">Short Description</th>
                                        <th style="width:200px;">Long Description</th>
                                        <th style="width:50px;">Quantity</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </div>


    <div class="col-lg-12">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Results
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="dataTable_wrapper" style="overflow:scroll;">
                            <table class="table table-bordered table-hover table-striped" id="InboundReports">
                                <thead>
                                    <tr>
                                        <th style="width:50px;">EventDate</th>
                                        <th style="width:50px;">InboundMasterID</th>
                                        <th style="width:50px;">LineItemID</th>
                                        <th style="width:150px;">SupplierName</th>
                                        <th style="width:50px;">PODate</th>
                                        <th style="width:100px;">PORef</th>
                                        <th style="width:50px;">ExpectedDeliveryDate</th>
                                        <th style="width:50px;">ProductStagingID</th>
                                        <th style="width:100px;">ProductCode</th>
                                        <th style="width:100px;">EANCode</th>
                                        <th style="width:150px;">ShortDescription</th>
                                        <th style="width:200px;">LongDescription</th>
                                        <th style="width:100px;">ExpectedQty</th>
                                        <th style="width:100px;">UnitCost</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </div>


    <div class="col-lg-12">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Results
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="dataTable_wrapper" style="overflow:scroll;">
                            <table class="table table-bordered table-hover table-striped" id="IGDsReports">
                                <thead>
                                    <tr>
                                        <th style="width:50px;">EventDate</th>
                                        <th style="width:50px;">IGDStagingID</th>
                                        <th style="width:100px;">MoveRef</th>
                                        <th style="width:100px;">PORef</th>
                                        <th style="width:70px;">ReceivedQuantity</th>
                                        <th style="width:100px;">SubmittedToWMS</th>
                                        <th style="width:50px;">LineItemID</th>
                                        <th style="width:50px;">OrderLineNumber</th>
                                        <th style="width:100px;">ProductStagingID</th>
                                        <th style="width:100px;">ProductCode</th>
                                        <th style="width:100px;">EANCode</th>
                                        <th style="width:150px;">ShortDescription</th>
                                        <th style="width:200px;">LongDescription</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </div>

    <div class="col-lg-12">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Results
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="dataTable_wrapper" style="overflow:scroll;">
                            <table class="table table-bordered table-hover table-striped" id="ReturnReports">
                                <thead>
                                    <tr>
                                        <th style="width:50px;">ReturnDate</th>
                                        <th style="width:50px;">OutboundConsignmentID</th>
                                        <th style="width:50px;">ReturnReferenceNumber</th>
                                        <th style="width:80px;">ProductCode</th>
                                        <th style="width:100px;">ShortDescription</th>
                                        <th style="width:150px;">LongDescription?</th>
                                        <th style="width:50px;">Quantity</th>
                                        <th style="width:50px;">WHReturnedDate</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </div>


    <!-- /.col-lg-12 -->
</div>
<div id="loading" class="spinner">
</div>

<link href="~/Content/Spinner.css" rel="stylesheet" />

<script src="~/bower_components/datatables 1.10.12/jquery/jquery-1.12.3.js"></script>
<script src="~/bower_components/datatables 1.10.12/media/js/jquery.dataTables.min.js"></script>
<script src="~/bower_components/datatables 1.10.12/extensions/Buttons/js/dataTables.buttons.min.js"></script>
<link href="~/bower_components/datatables 1.10.12/media/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/bower_components/datatables 1.10.12/extensions/Buttons/css/buttons.dataTables.min.css" rel="stylesheet" />
<script src="~/bower_components/datatables 1.10.12/extensions/Buttons/js/buttons.flash.min.js"></script>
<script src="~/bower_components/datatables 1.10.12/extensions/Buttons/js/buttons.html5.min.js"></script>
<script src="~/bower_components/datatables 1.10.12/extensions/Buttons/js/buttons.print.min.js"></script>

<script src="~/Scripts/bootstrap-datepicker-1.4.0/js/bootstrap-datepicker.js"></script>
<link href="~/Scripts/bootstrap-datepicker-1.4.0/css/bootstrap-datepicker.css" rel="stylesheet">


<style>
    .modal-dialog {
        width: 750px;
    }
</style>

<script>

    var oReportTableSOH = null;
    var oReportInboundMaster = null;
    var oReportIGD = null;
    var oReportReturn = null;

    $(document).ready(function () {

        var $loading = $('#loading');
        $(document).ajaxStart(function () {
            $loading.show();
        }).ajaxStop(function () {
            $loading.hide();
        });

        InitializeDateRange();
        SelectReportType();
    });

    function SelectReportType() {

        $('#ReportList').on('change', function (e) {

            var listVal = $('#ReportList :selected').text();

            if (listVal == "StockOnHand") {

                GetStockOnHand();
                ResetDataTableSOH();
            }
            if (listVal == "Dispatched") {

            }
            if (listVal == "Received") {

                if ($('#txtDateFrom').val() != '' || $('#txtDateTo').val() != '') {

                    GetInboundMaster($('#txtDateFrom').val(), $('#txtDateTo').val());
                }
                else {
                    //swal("Please Add Products to Order", "Save Order", "error")
                    alert("Please Select Date Range");
                }
            }
            if (listVal == "IGDs") {

                if ($('#txtDateFrom').val() != '' || $('#txtDateTo').val() != '') {

                    GetIGD($('#txtDateFrom').val(), $('#txtDateTo').val());
                }
                else {
                    //swal("Please Add Products to Order", "Save Order", "error")
                    alert("Please Select Date Range");
                }
            }
            if (listVal == "ReturnReceipt") {

                if ($('#txtDateFrom').val() != '' || $('#txtDateTo').val() != '') {

                    GetReturnReceipt($('#txtDateFrom').val(), $('#txtDateTo').val());
                }
                else {
                    //swal("Please Add Products to Order", "Save Order", "error")
                    alert("Please Select Date Range");
                }
            }
            $('#ReportList').prop('selectedIndex', 0);
        });
    }

    function InitializeDateRange() {

        //init the date picker
        $('#txtDateFrom').datepicker({
            dateFormat: "yyyy-mm-dd",
            autoclose: true
        });

        //init the date picker
        $('#txtDateTo').datepicker({
            dateFormat: "yyyy-mm-dd",
            autoclose: true
        });
    }

    function GetStockOnHand() {

        if (oReportTableSOH != null) {
            oReportTableSOH.destroy();
        }

        oReportTableSOH = $('#StockOnHandReports').DataTable({
            "order": [[1, "asc"]],
            "destroy": true,
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "dom": 'Bfrtip',
            "buttons": ["csv", "excel", "pdf", "print"],
            "bServerSide": false,
            "sAjaxSource": '@Url.Action("GetStockOnHand", "Reports")',
            "bProcessing": true,
            "fnServerData": function (sSource, parameters, fnCallback) {
                parameters.push({ "name": "filter", "value": "" });

                $.getJSON(sSource, parameters, function (json) {
                    fnCallback(json)
                })
                .done(function () { })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    swal("ERROR: " + errorThrown);
                    console.log("ERROR: " + errorThrown);
                    console.log("RESPONSE TEXT: " + jqXHR.responseText);
                })
                .always(function () { });
            },
            "columns": [
                            { "data": "ProdCode" },
                            { "data": "ProdEAN" },
                            { "data": "ShortDesc" },
                            { "data": "LongDesc" },
                            { "data": "Qty" }
            ]
        });
    }


    function GetInboundMaster(DateFrom, DateTo) {

        if (oReportInboundMaster != null) {
            oReportInboundMaster.destroy();
        }

        oReportInboundMaster = $('#InboundReports').DataTable({
            "order": [[1, "asc"]],
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "dom": 'Bfrtip',
            "buttons": ["csv", "excel", "pdf", "print"],
            "bServerSide": false,
            "sAjaxSource": '@Url.Action("GetInboundMaster", "Reports")',
            "bProcessing": true,
            "fnServerData": function (sSource, parameters, fnCallback) {

                var data = JSON.stringify({
                    DateFrom: DateFrom,
                    DateTo: DateTo
                });

                parameters.push({ "name": "formData", "value": data });

                $.getJSON(sSource, parameters, function (json) {
                    fnCallback(json)
                })
                .done(function () { })
                .fail(function (jqXHR, textStatus, errorThrown) {

                    swal(textStatus + ": " + errorThrown);

                    console.log("Error: " + errorThrown);
                    console.log("responseText: " + jqXHR.responseText);
                })
                .always(function () { });
            },
            "columns": [
                            { "data": "EventDate" },
                            { "data": "InboundMasterID" },
                            { "data": "InboundMasterLineItemID" },
                            { "data": "SupplierName" },
                            { "data": "PODate" },
                            { "data": "PORef" },
                            { "data": "ExpectedDeliveryDateTime" },
                            { "data": "ProductStagingID" },
                            { "data": "ProdCode" },
                            { "data": "EANCode" },
                            { "data": "ShortDesc" },
                            { "data": "LongDesc" },
                            { "data": "ExpectedQuantity" },
                            { "data": "UnitCost" }
            ]
        });
    }

    function GetIGD(DateFrom, DateTo) {

        if (oReportIGD != null) {
            oReportIGD.destroy();
        }

        oReportIGD = $('#IGDsReports').DataTable({
            "order": [[1, "asc"]],
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "dom": 'Bfrtip',
            "buttons": ["csv", "excel", "pdf", "print"],
            "bServerSide": false,
            "sAjaxSource": '@Url.Action("GetIGDs", "Reports")',
            "bProcessing": true,
            "fnServerData": function (sSource, parameters, fnCallback) {

                var data = JSON.stringify({
                    DateFrom: DateFrom,
                    DateTo: DateTo
                });

                parameters.push({ "name": "formData", "value": data });

                $.getJSON(sSource, parameters, function (json) {
                    fnCallback(json)
                })
                .done(function () { })
                .fail(function (jqXHR, textStatus, errorThrown) {

                    swal(textStatus + ": " + errorThrown);

                    console.log("Error: " + errorThrown);
                    console.log("responseText: " + jqXHR.responseText);
                })
                .always(function () { });
            },
            "columns": [
                            { "data": "EventDate" },
                            { "data": "IGDStagingID" },
                            { "data": "MoveRef" },
                            { "data": "PORef" },
                            { "data": "ReceivedQuantity" },
                            { "data": "SubmittedToWMS" },
                            { "data": "InboundMasterLineItemID" },
                            { "data": "OrderLineNo" },
                            { "data": "ProductStagingID" },
                            { "data": "ProdCode" },
                            { "data": "EANCode" },
                            { "data": "ShortDesc" },
                            { "data": "LongDesc" }
            ]
        });
    }

    function GetReturnReceipt(DateFrom, DateTo) {

        if (oReportReturn != null) {
            oReportReturn.destroy();
        }

        oReportReturn = $('#ReturnReports').DataTable({
            "order": [[1, "asc"]],
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "dom": 'Bfrtip',
            "buttons": ["csv", "excel", "pdf", "print"],
            "bServerSide": false,
            "sAjaxSource": '@Url.Action("GetReturnReceipt", "Reports")',
            "bProcessing": true,
            "fnServerData": function (sSource, parameters, fnCallback) {

                var data = JSON.stringify({
                    DateFrom: DateFrom,
                    DateTo: DateTo
                });

                parameters.push({ "name": "formData", "value": data });

                $.getJSON(sSource, parameters, function (json) {
                    fnCallback(json)
                })
                .done(function () { })
                .fail(function (jqXHR, textStatus, errorThrown) {

                    swal(textStatus + ": " + errorThrown);

                    console.log("Error: " + errorThrown);
                    console.log("responseText: " + jqXHR.responseText);
                })
                .always(function () { });
            },
            "columns": [
                            { "data": "ReturnDate" },
                            { "data": "OutboundConsignmentID" },
                            { "data": "ReturnReferenceNumber" },
                            { "data": "ProductCode" },
                            { "data": "ShortDescription" },
                            { "data": "LongDescription" },
                            { "data": "Quantity" },
                            { "data": "WHReturnedDate" }
            ]
        });
    }

    function ResetDataTableSOH() {

            var data = new Object();
            data.sEcho = null;
            data.iTotalRecords = 0;
            data.iTotalDisplayRecords = 0;
            data.aaData = null;

            oReportTableSOH = $('#StockOnHandReports').DataTable({
                "order": [[1, "asc"]],
                "destroy": true,
                "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
                "bServerSide": false,
                "bProcessing": true,
                "data": data
            });

    }

    function ResetDataTableRCG() {

        var data = new Object();
        data.sEcho = null;
        data.iTotalRecords = 0;
        data.iTotalDisplayRecords = 0;
        data.aaData = null;

        oReportInboundMaster = $('#InboundReports').DataTable({
            "order": [[1, "asc"]],
            "destroy": true,
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "bServerSide": false,
            "bProcessing": true,
            "data": data
        });

    }

    function ResetDataTableIGD() {

        var data = new Object();
        data.sEcho = null;
        data.iTotalRecords = 0;
        data.iTotalDisplayRecords = 0;
        data.aaData = null;

        oReportIGD = $('#IGDsReports').DataTable({
            "order": [[1, "asc"]],
            "destroy": true,
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "bServerSide": false,
            "bProcessing": true,
            "data": data
        });

    }

    function ResetDataTableReturn() {

        var data = new Object();
        data.sEcho = null;
        data.iTotalRecords = 0;
        data.iTotalDisplayRecords = 0;
        data.aaData = null;

        oReportReturn = $('#ReturnReports').DataTable({
            "order": [[1, "asc"]],
            "destroy": true,
            "lengthMenu": [[20, 30, 40, -1], [20, 30, 40, "All"]],
            "bServerSide": false,
            "bProcessing": true,
            "data": data
        });

    }
</script>