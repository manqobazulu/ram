
@{
    ViewBag.Title = "Order Item Line Edit";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@model WMSCustomerPortal.Models.Common.OutboundOrder

<div class="row">
    <div class="col-lg-12">
         
        <div class="panel panel-default">
            <div class="panel-heading">
                @Html.ActionLink("Back to Outbound Main", "OutboundMain", "Outbound")
            </div>

            <div class="panel-body">
                <form role="form" id="formUpdateOrder" onsubmit="return false;">
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="row" style="display: none;">
                                    <div class="col-xs-8 col-sm-6">
                                        <div class="form-group">
                                        <button id="btnAddNewCustomer" type="button" class="btn btn-primary btn-xs" data-dismiss="modal">Add New Customer</button>
                                        </div>
                                    </div>
                                    <div class="col-xs-4 col-sm-6">
                                        <div class="form-group">
                                        </div>
                                    </div>
                                </div>

                                <div class="row" id="StatusRow" style="display: none;">
                                    <div class="col-xs-4 col-sm-6" id="OrderStatus" style="display: none;">
                                        <div class="form-group">
                                            <label>Order Status</label>
                                            <input class="form-control" id="txtOrderStatus" name="txtOrderStatus" disabled>
                                        </div>
                                    </div>
                                    <div class="col-xs-8 col-sm-6" id="FailedReason" style="display: none;">
                                        <div class="form-group">
                                            <label>Failed Reason</label>
                                            <input class="form-control" id="txtFailedReason" name="txtFailedReason" disabled>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-8 col-sm-6">
                                        <div class="form-group">
                                            <label id="labelName">Customer</label>
                                            <input class="form-control" placeholder="Customer Name" id="txtReceiverName" name="txtReceiverName">
                                            <p class="help-block">Search for CustomerID/Customer Name</p>
                                        </div>
                                    </div>
                                    <div class="col-xs-4 col-sm-6">
                                        <div class="form-group">
                                            <label id="labelName">Invoice Customer</label>
                                            <input class="form-control" placeholder="Invoice Customer Name" id="txtInvoiceName" name="txtInvoiceName" disabled>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-8 col-sm-6">
                                        <div class="form-group">
                                            <h4>Shipping Address</h4>
                                            <div id="divSelectedCustomer">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-4 col-sm-6">
                                        <div class="form-group">
                                            <h4>Billing Address</h4>
                                            <div id="divShippCustomer">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- /.panel -->
                            </div>
                            <!-- /.col-lg-12 -->
                        </div>


                    </div>
                </form>

                <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Results
                            </div>
                            <!-- /.panel-heading -->
                            <div class="panel-body">
                                @Html.HiddenFor(model => model.OutboundOrderID, new { id = "hdnOrderID" })
                                <input type="hidden" id="hdnSavehdnOrderID" name="hdnSavehdnOrderID" value="">
                                <form role="form" onsubmit="return false;">
                                    <table id="tblOrderLineItems" class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Line Item ID</th>
                                                <th>Product ID</th>
                                                <th>Product Code</th>
                                                <th>EAN Code</th>
                                                <th>Short Description</th>
                                                <th>Long Description</th>
                                                <th>Unit Cost</th>
                                                <th>Quantity</th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                        <tfoot>
                                            <tr id="trLineEntry">
                                                <td></td>
                                                <td><input id="txtLineItemID" type="text" class="cellLineItemID" disabled /></td>
                                                <td><input id="txtProductStagingID" type="text" class="cellStagingProdID" disabled /></td>
                                                <td><input id="txtProdCode" type="text" class="cellProdCode autocomplete" /></td>
                                                <td><input id="txtEANCode" type="text" class="cellEANCode autocomplete" /></td>
                                                <td><input id="txtShortDesc" type="text" class="cellShortDesc autocomplete" /></td>
                                                <td><input id="txtLongDesc" type="text" class="cellLongDesc autocomplete" /></td>
                                                <td><input id="txtUnitCost" type="text" class="cellUnitCost numeric" disabled /></td>
                                                <td><input id="txtQty" type="text" class="cellQty numeric" />
                                                <td><input id="btnAddLineItem" type="button" value="Add" class="btn btn-primary btn-xs" /></td>
                                                <td><input id="btnReset" type="button" value="Reset" class="btn btn-primary btn-xs" /></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                    <!-- /#tblOrderLineItems -->
                                    <div style="float:right;">
                                        <button id="btnSaveOrderLine" type="button" class="btn btn-primary btn-xs" data-dismiss="modal">Save Order</button>
                                    </div>

                                </form>
                            </div>
                            <!-- /.panel-body -->
                        </div>
                        <!-- /.panel -->
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <!-- /.row -->
            </div>
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-12 -->

<div class="modal fade bs-example-modal-lg" id="modalAddNew" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" data-whatever="mdo">&times;</button>
                <h4 class="modal-title" id="myModalLabel2">Customer Add/Edit</h4>
            </div>

            <ul class="nav nav-tabs" id="Address">
                <li class="active">
                    <a href="#ShippingAddress" data-toggle="tab">Shipping Address</a>
                </li>
                <li>
                    <a href="#BillingAddress" data-toggle="tab">Billing Address</a>
                </li>
            </ul>

            <div class="modal-body">
                <div class="tab-content">
                    @* The billing and Shipping Address Panels *@
                    <div class="tab-pane fade in active" id="ShippingAddress">
                        <div class="panel-body">

                            <div class="row">
                                <div class="col-lg-12">
                                    <form role="form" id="formShipping" onsubmit="return false;">

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Customer Group</label>
                                                    <input class="form-control" placeholder="Customer Group" id="txtCustomerGroup" name="txtCustomerGroup" disabled>
                                                    @*<p class="help-block">Example block-level help text here.</p>*@
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label id="labelName">Company ID</label>
                                                    <input class="form-control" placeholder="Company ID" id="txtCustomerID" name="txtCustomerID" disabled>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label id="labelName">Customer Name</label>
                                            <input class="form-control" placeholder="Company Name" id="txtCustomerName" name="txtCustomerName" maxlength="50">
                                        </div>
                                        <div class="form-group">
                                            <label>Default Contact</label>
                                            <input class="form-control" placeholder="Default Contact" id="txtDefaultContact" name="txtDefaultContact" maxlength="50">
                                        </div>

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Tel No</label>
                                                    <input class="form-control ContactNumbers" placeholder="Telephone No" id="txtTelephone" name="txtTelephone">
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Cell No</label>
                                                    <input class="form-control ContactNumbers" placeholder="Cell No" id="txtCellNo" name="txtCellNo">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Fax No</label>
                                                    <input class="form-control ContactNumbers" placeholder="Fax No" id="txtFaxNo" name="txtFaxNo">
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>StoreCode</label>
                                                    <input class="form-control" placeholder="StoreCode" id="txtStoreCode" name="txtStoreCode" maxlength="20">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Email</label>
                                            <input class="form-control" placeholder="Email Address" id="txtEmail" name="txtEmail" maxlength="50">
                                        </div>

                                        <div class="form-group">
                                            <label>Street Address 1</label>
                                            <input class="form-control" placeholder="Street Address 1" id="txtStreetAddress1" name="txtStreetAddress1" maxlength="50">
                                        </div>
                                        <div class="form-group">
                                            <label>Street Address 2</label>
                                            <input class="form-control" placeholder="Street Address 2" id="txtStreetAddress2" name="txtStreetAddress2" maxlength="50">
                                        </div>

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Suburb</label>
                                                    <input class="form-control" placeholder="Suburb" id="txtSuburb" name="txtSuburb">
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Area</label>
                                                    <input class="form-control" placeholder="Area" id="txtArea" name="txtArea" disabled>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-4">
                                                <div class="form-group">
                                                    <label>Postal Code</label>
                                                    <input class="form-control" placeholder="Postal Code" id="txtPostalCode" name="txtPostalCode" disabled>
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-4">
                                                <div class="form-group">
                                                    <label>HubID</label>
                                                    <input class="form-control" placeholder="HubID" id="txtHubID" name="txtHubID" disabled>
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-4">
                                                <div class="form-group">
                                                    <label>International</label>
                                                    <input class="form-control" placeholder="International" id="txtInternational" name="txtInternational" disabled>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>

                        <div class="col-md-12 col-md-push-9">
                            <div class="form-group">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>&nbsp;
                                <button type="button" class="btn btn-primary" id="btnSaveCustomer">Save</button>
                            </div>
                        </div>

                    </div>

                    @* The billing and Shipping Address Panels *@
                    <div class="tab-pane fade in" id="BillingAddress">
                        <div class="panel-body">

                            <div class="row">
                                <div class="col-lg-12">
                                    <form role="form" id="formBilling" onsubmit="return false;">

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Customer Group</label>
                                                    <input class="form-control" placeholder="Customer Group" id="txtCustomerGroupBilling" name="txtCustomerGroupBilling" disabled>
                                                    @*<p class="help-block">Example block-level help text here.</p>*@
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label id="labelName">Company ID</label>
                                                    <input class="form-control" placeholder="Company ID" id="txtCustomerIDBilling" name="txtCustomerIDBilling" disabled>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label id="labelName">Customer Name</label>
                                            <input class="form-control" placeholder="Company Name" id="txtCustomerNameBilling" name="txtCustomerNameBilling" maxlength="50">
                                            <p id="pCustomer" class="help-block">Search for CustomerID/Customer Name</p>
                                        </div>
                                        <div class="form-group">
                                            <label>Default Contact</label>
                                            <input class="form-control" placeholder="Default Contact" id="txtDefaultContactBilling" name="txtDefaultContactBilling" maxlength="50">
                                        </div>

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Tel No</label>
                                                    <input class="form-control ContactNumbers" placeholder="Telephone No" id="txtTelephoneBilling" name="txtTelephoneBilling">
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Cell No</label>
                                                    <input class="form-control ContactNumbers" placeholder="Cell No" id="txtCellNoBilling" name="txtCellNoBilling">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Fax No</label>
                                                    <input class="form-control ContactNumbers" placeholder="Fax No" id="txtFaxNoBilling" name="txtFaxNoBilling">
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>StoreCode</label>
                                                    <input class="form-control" placeholder="StoreCode" id="txtStoreCodeBilling" name="txtStoreCodeBilling" maxlength="20">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Email</label>
                                            <input class="form-control" placeholder="Email Address" id="txtEmailBilling" name="txtEmailBilling" maxlength="50">
                                        </div>

                                        <div class="form-group">
                                            <label>Street Address 1</label>
                                            <input class="form-control" placeholder="Street Address 1" id="txtStreetAddress1Billing" name="txtStreetAddress1Billing" maxlength="50">
                                        </div>
                                        <div class="form-group">
                                            <label>Street Address 2</label>
                                            <input class="form-control" placeholder="Street Address 2" id="txtStreetAddress2Billing" name="txtStreetAddress2Billing" maxlength="50">
                                        </div>

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-6">
                                                <div class="form-group">
                                                    <label>Suburb</label>
                                                    <input class="form-control" placeholder="Suburb" id="txtSuburbBilling" name="txtSuburbBilling">
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Area</label>
                                                    <input class="form-control" placeholder="Area" id="txtAreaBilling" name="txtAreaBilling" disabled>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xs-8 col-sm-4">
                                                <div class="form-group">
                                                    <label>Postal Code</label>
                                                    <input class="form-control" placeholder="Postal Code" id="txtPostalCodeBilling" name="txtPostalCodeBilling" disabled>
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-4">
                                                <div class="form-group">
                                                    <label>HubID</label>
                                                    <input class="form-control" placeholder="HubID" id="txtHubIDBilling" name="txtHubIDBilling" disabled>
                                                </div>
                                            </div>
                                            <div class="col-xs-4 col-sm-4">
                                                <div class="form-group">
                                                    <label>International</label>
                                                    <input class="form-control" placeholder="International" id="txtInternationalBilling" name="txtInternationalBilling" disabled>
                                                </div>
                                            </div>
                                        </div>


                                    </form>
                                </div>
                            </div>

                        </div>

                        <div class="col-md-12 col-md-push-9">
                            <div class="form-group">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>&nbsp;
                                <button type="button" class="btn btn-primary" id="btnSaveBillingCustomer">Save Billing</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div style="float:left">
                            <label>
                                Billing Address The Same as Shipping Address
                                <input type="checkbox" id="chkBilltoShip" name="chkBilltoShip" checked="checked">
                            </label>
                        </div>
                    </div>
                </div>


                <!-- /.panel -->
            </div>
            <!-- /.modal-body -->
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<div id="loading" class="spinner">
</div>
<div id="divSuburbDetails" style="z-index: 3; position: absolute; top: 10px; left: 10px;
                            opacity: 1; filter: alpha(opacity=100); -moz-opacity: 1; text-decoration: none;
                            display: none" class="autocomplete_highlightedListItem">
    Some text here
</div>


<input type="hidden" id="hiddenZoneID" />
<input type="hidden" id="hiddenCustomerGroupID" />
<input type="hidden" id="hiddenAction" value="" />
<input type="hidden" id="hiddenCustomerID" value="" />

<style>


    input {
        border: 1px solid #ccc;
        width: 100%;
        height: 100%;
        padding: 0 4px 0 4px;
    }

        input:focus {
            border: 1px solid #808080;
            outline: none;
        }

    .numeric {
    }

    .autocomplete {
    }

    .cellLineItemID {
        width: 50px;
    }

    .cellLineNumber {
        width: 50px;
    }

    .cellStagingProdID {
        width: 50px;
    }

    .cellProdCode {
    }

    .cellEANCode {
    }

    .cellShortDesc {
        width: 200px;
    }

    .cellLongDesc {
        width: 300px;
    }

    .cellUnitCost {
        width: 50px;
    }

    .cellSalesPrice {
        width: 50px;
    }

    .cellQty {
        width: 50px;
    }

    .lineItem {
    }

    .deleteRow {
    }

    .modal-dialog {
        width: 850px;
    }

    form label.error {
        color: crimson;
    }

    .ContactNumbers {
    }
</style>

<input type="hidden" id="hiddenBillingZoneID" />
<input type="hidden" id="hiddenZoneID" />
<input type="hidden" id="hiddenCustomerGroupID" />
<input type="hidden" id="hiddenAction" value="" />
<input type="hidden" id="hiddenCustomerID" value="" />

<link href="~/bootstrap/css/bootstrap.css" rel="stylesheet" />
<link href="~/Content/Spinner.css" rel="stylesheet" />

<!-- jQuery UI CSS -->
<link href="~/Content/jquery-ui.min.css" rel="stylesheet" />
<link href="~/Content/jquery.ui.autocomplete.css" rel="stylesheet" />

<script src="~/Scripts/jquery-2.1.4.min.js"></script>
<script src="~/Scripts/BestUpper/jquery.bestupper.min.js"></script>
<script src="~/Scripts/jquery.tmpl.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery-ui.min.js"></script>
<script src="~/Scripts/MaskedInput/jquery.maskedinput.min.js"></script>
<script src="~/Scripts/Numeric/jquery.numeric.min.js"></script>
<script src="~/Scripts/jquery.HotKeys/jquery.hotkeys.js"></script>

<script>

    var OrderArray = [];
    var DetailArray = [];
    var tableArray = [];
    var gloCustomerDetailID = 0;
    var gloBillingCustomerDetailID = 0;
    var gloCustomerID = null;
    var gloBillingCustomerID = null;
    var btn;
    var thisValidatedFormUpdateOrder = null;
    var thisValidatedAddNewForm = null;
    var thisValidatedBillingForm = null;
    var BillingCustomerID = null;
    var ShippingCustomerID = null;
    var pOrderID;

    $(document).ready(function () {

        $(".ContactNumbers").mask("999 999 9999");

        $("input.form-control").bestupper();

        //if ($('#UserLevel').val() == 'true') {
        //    $('#btnAddNewCustomer').attr("disabled", "disabled");
        //}

        var $loading = $('#loading');
        $(document).ajaxStart(function () {
            $loading.show();
        }).ajaxStop(function () {
            $loading.hide();
        });

        OrderArray = $("#hdnOrderID").val().split('/');
        btn = OrderArray[1];
        var OrderID = OrderArray[0];
        pOrderID = OrderID;
        GetOrderDetail(OrderID);

        $("input.form-control").bestupper();

        CustomerNameAutoComplete();
        EditableGridPageDefaults();
        EditableGridConfig();
        PopulateInboundMasterLineItemsList(OrderID);
        ConfigureOrderSaveValidation();

        if (btn == 'C') {
            $('#trLineEntry').hide();
            $('#btnSaveOrderLine').hide();
            $('#btnAddNewCustomer').hide();
            $('#btnAddNewCustomer').attr('disabled', 'disabled');
            $('#txtReceiverName').attr('disabled', 'disabled');
            $('#btnAddLineItem').attr('disabled', 'disabled');
            $('#btnReset').attr('disabled', 'disabled');
            $('#btnSaveOrderLine').attr('disabled', 'disabled');

            GetOrderStatus(OrderID);
        }

        WireAdditionalActions();

    });

    function GetOrderStatus(OrderID) {
        var parameters = JSON.stringify({
            OrderID: OrderID
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("GetOrderStatus", "Outbound")',
            data: parameters,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                var Data = result.Data[0];
                var Reason = "";
                if (Data.RejectError) {
                    Reason += Data.RejectError;
                } 

                var Status = "";
                if (Data.Status) {
                    Status += Data.Status;
                }

                if (Status) {
                    $('#StatusRow').show();
                    $('#OrderStatus').show();
                    $('#txtOrderStatus').val(Status);

                    if (Reason) {
                        $('#FailedReason').show();
                        $('#txtFailedReason').val(Reason);  
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                //swal({
                //    title: 'Error',
                //    text: 'There was an error:' + errorThrown,
                //    type: 'error',
                //    confirmButtonText: 'OK',
                //    confirmButtonColor: '#D42E12'
                //});
            }
        });
    }

    function WireAdditionalActions() {

        $('#btnSaveOrderLine').click(function () {

            if (IsUpdateOrderSaveValid()) {

                var Entries = parseInt($('#tblOrderLineItems tbody').children('tr').length);

                if (Entries > 0 && Entries < 100) {

                    var bool = SubmitOrder();
                    if (bool == true) {
                        SaveLineItems();
                    }
                }
                else {
                    swal("Please Add Products to Order");
                }
            }
        });

        $('#btnAddNewCustomer').click(function () {

            $('#chkBilltoShip').removeAttr('disabled', 'disabled');
            $('#chkBilltoShip').prop('checked', true);
            $('#txtCustomerName').focus();
            ConfigureCustomerSaveValidation();
            ConfigureAddNewModal();
            CustomerNameBillingAutoComplete();
            BillingSuburbLookup();
            ConfigureCustomerBillingSaveValidation();
            chkBilling();
        });

        $('#modalAddNew').on('hidden.bs.modal', function (e) {
            // Reset modal inputs

            $('#hiddenAction').val('');

            // Reset Validation
            thisValidatedAddNewForm.resetForm();
            thisValidatedBillingForm.resetForm();
        });

        $('#btnSaveCustomer').click(function (event) {
            event.preventDefault();
            if (IsCustomerSaveValid()) {
                SaveCustomer();
            }
        });

        $('#btnSaveBillingCustomer').click(function (event) {
            event.preventDefault();
            if (IsCustomerSaveBillingValid()) {
                SaveCustomer();
            }
        });

    }

    function checkInputQuantity() {

        var LineItemQty = parseInt($('#txtQty').val() || 0);
        var parameters = JSON.stringify({
            ProductCode: $('#txtProdCode').val(),
            Quantity: LineItemQty
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("CheckStockQuantity", "Outbound")',
            data: parameters,
            dataType: "json",
            success: function (response) {
                var result = response.Result;
                if (result == 'OK') {
                    AddLineItem();
                }
                else {
                    $('#txtQty').val("");
                    $('#txtQty').focus();
                    swal({
                        title: "Error",
                        text: result,
                        type: "error",
                        confirmButtonText: "OK",
                        confirmButtonColor: "#D42E12"
                    });
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }


    function SubmitOrder() {
        var j = 0;
        $('#tblOrderLineItems tr').each(function (i, row) {

            if (i != 0) {
                var $row1 = $(row), $LineItemID = $row1.find('input[id*="txtLineItemID"]');
                var $row2 = $(row), $ProductStagingID = $row2.find('input[id*="txtProductStagingID"]');
                var $row3 = $(row), $inputQuantity = $row3.find('input[id*="txtQty"]');

                if (($LineItemID.val() != '') && ($ProductStagingID.val() != 0) && ($inputQuantity.val() > 0)) {
                    tableArray[j] = [$LineItemID.val() + '|' + $ProductStagingID.val() + '|' + $inputQuantity.val()];
                    j++;
                }
                else {
                    return false;
                }
            }
        });
        return true;
    }

    function PopulateInboundMasterLineItemsList(inOrderID) {

        var session = 'WMSSession.TempOutboundItemLine';

        var parameters = JSON.stringify({
            OrderID: inOrderID,
            viewSession: session
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("EditableGrid_PrepopulateLineItems", "Outbound")',
            data: parameters,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                //Clear all inputs in line entry
                $('#trLineEntry').find('input:text').val('');

                var templateContainer = $("#tblOrderLineItems tbody").empty();
                var json = { 'Records': result.Data };

                if (btn == 'C') {
                    $("#tmplViewOrderLineItems").tmpl(json).appendTo(templateContainer);
                }
                else if (btn == 'P') {
                    $("#tmplOrderLineItems").tmpl(json).appendTo(templateContainer);
                }

                // Reapply plugins/bind controls
                EditableGridConfig();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function GetLineItems() {

        var session = 'WMSSession.TempOutboundItemLine';

        var parameter = JSON.stringify({
            viewSession: session
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("EditableGrid_GetLineItems", "Outbound")',
            data: parameter,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                // Clear all inputs in line entry
                $('#trLineEntry').find('input:text').val('');

                var templateContainer = $("#tblOrderLineItems tbody").empty();
                var json = { 'Records': result.Data };

                $("#tmplOrderLineItems").tmpl(json).appendTo(templateContainer);

                // Reapply plugins/bind controls
                EditableGridConfig();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }


    function EditableGridPageDefaults() {

        $('#btnAddLineItem').click(function () {

            var LineItemQty = parseInt($('#txtQty').val() || 0);

            if (IsLineItemAddValid()) {

                if (LineItemQty > 0) {
                    checkInputQuantity();
                }
                else {
                    $('#txtQty').val('');
                    swal("Error - The quantity you submitted is invalid", "", "error");
                }

            }

        });

        $('#btnReset').click(function () {
            $('#trLineEntry').find('input:text').val('');
            $('#txtProdCode').focus();
        });

        $('#tblOrderLineItems').on('keydown', '#txtQty', function (e) {
            var keyCode = e.keyCode || e.which;
            if (keyCode === 9) {
                e.preventDefault();

                checkInputQuantity();
                //AddLineItem();

            }
        });

        // Binding keys
        $(document).bind('keydown', 'ctrl+a', function assets() {

            SaveLineItems();

            return false;
        });
        $('#txtProdCode').bind('keydown', 'ctrl+a', function assets() {

            SaveLineItems();

            return false;
        });
    }

    function EditableGridConfig() {

        BindAutocomplete();


        $(".numeric").numeric({ decimal: false, negative: false }, function () { swal("Positive integers only"); this.value = ""; this.focus(); });

        $(".currency").numeric({ decimal: true, decimalPlaces: 2, negative: false }, function () { swal("Positive currency values only"); this.value = "0.00"; this.focus(); });

        $('.deleteRow').click(DeleteRow);

        //$('.lineItem .cellQty').blur(UpdateRow);
        $('.lineItem .cellQty').blur(checkUpdateInputQuantity);

        $('#txtProdCode').focus();
    }

    /* Add **********************************************************************************/
    function AddLineItem() {

        var lineItem = new Object();
        lineItem.LineNumber = (parseInt($('#tblOrderLineItems tbody').children('tr').length) + 1);
        lineItem.ProductStagingID = $('#txtProductStagingID').val();
        lineItem.LineItemID = $('#txtLineItemID').val();
        lineItem.ProductCode = $('#txtProdCode').val();
        lineItem.EANCode = $('#txtEANCode').val();
        lineItem.ShortDescription = $('#txtShortDesc').val();
        lineItem.LongDescription = $('#txtLongDesc').val();
        var UnitCost = $.trim($('#txtUnitCost').val());
        var FloatUnitCost = parseFloat(UnitCost).toFixed(0);

        lineItem.UnitCost = FloatUnitCost;
        lineItem.Quantity = $('#txtQty').val();

        var session = 'WMSSession.TempOutboundItemLine';

        var parameters = JSON.stringify({
            lineItem: lineItem,
            viewSession: session
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("EditableGrid_AddLineItem_Pre", "Outbound")',
            data: parameters,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

                if (result.Result.search(/error/i) == -1) {

                    // Clear all inputs in line entry
                    $('#trLineEntry').find('input:text').val('');

                    var templateContainer = $("#tblOrderLineItems tbody").empty();
                    var json = { 'Records': result.Data };

                    $("#tmplOrderLineItems").tmpl(json).appendTo(templateContainer);

                    // Reapply plugins/bind controls
                    EditableGridConfig();
                    $('#txtProdCode').focus();

                }
                else {
                    swal(result.Result);
                    // Clear all inputs in line entry
                    //$('#trLineEntry').find('input:text').val('');
                    $('#txtQty').val('');
                    $('#txtQty').focus()
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function IsLineItemAddValid() {
        var isAddValid = true;

        if ($('#txtProdCode').val() == '') {
            $('#txtProdCode').focus();

            swal('Please select a product');

            isAddValid = false;
        }

        return isAddValid;
    }


    /* Delete **********************************************************************************/
    function DeleteRow() {

        if (btn != 'View') {

            var tr = $(this).closest('tr');

            var LineNumber = tr.find(".cellLineNumber").html();
            var LineItemID = tr.find(".cellLineItemID").val();
            var UnitCost = tr.find(".cellUnitCost").val();
            var Quantity = tr.find(".cellQty").val();

            swal({
                title: "Are you sure you want to delete no." + LineNumber + " ?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "OK",
                closeOnConfirm: false
            }, function () {
                $(this).parents('tr').first().remove();
                RemoveLineItem(LineNumber, LineItemID, UnitCost, Quantity);
            });


        }
    }

    function RemoveLineItem(LineNumber, LineItemID, UnitCost, Quantity) {

        var session = 'WMSSession.TempOutboundItemLine';

        var parameters = JSON.stringify({
            pLineNumber: LineNumber,
            pLineItemID: LineItemID,
            viewSession: session
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("DeleteOrderLine", "Outbound")',
            data: parameters,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

                swal("Deleted!", "Line Number: " + LineNumber + ".", "success");

                $('#trLineEntry').find('input:text').val('');

                var templateContainer = $("#tblOrderLineItems tbody").empty();
                var json = { 'Records': result.Data };

                $("#tmplOrderLineItems").tmpl(json).appendTo(templateContainer);
                EditableGridConfig();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function checkUpdateInputQuantity() {

        var tr = $(this).closest('tr');

        // $(this).parents('tr').first().remove();

        var lineItem = new Object();

        lineItem.LineNumber = tr.find(".cellLineNumber").html();
        lineItem.ProductStagingID = tr.find(".cellStagingProdID").val();
        lineItem.ProductCode = tr.find(".cellProdCode").val();
        lineItem.EANCode = tr.find(".cellEANCode").val();
        lineItem.ShortDescription = tr.find(".cellShortDesc").val();
        lineItem.LongDescription = tr.find(".cellLongDesc").val();
        lineItem.UnitCost = tr.find(".cellUnitCost").val();
        lineItem.Quantity = tr.find(".cellQty").val();

        var pProductCode = tr.find(".cellProdCode").val();
        var pQuantity = tr.find(".cellQty").val();

        var parameters = JSON.stringify({
            ProductCode: pProductCode,
            Quantity: pQuantity
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("CheckStockQuantity", "Outbound")',
            data: parameters,
            dataType: "json",
            success: function (response) {
                var result = response.Result;
                if (result == 'OK') {
                   // UpdateLineItem(lineItem);
                    tr.find(".cellQty").val(pQuantity);
                }
                else {
                    $('#txtQty').focus();
                    $('#txtQty').val('');
                    tr.find(".cellQty").val('');

                    swal({
                        title: "Error",
                        text: result,
                        type: "error",
                        confirmButtonText: "OK",
                        confirmButtonColor: "#D42E12"
                    });
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    /* Update **********************************************************************************/
    function UpdateRow() {

        var tr = $(this).closest('tr');

        $(this).parents('tr').first().remove();

        //var lineNumber = tr.find(".cellLineNumber").html();
        //var productstagingid = tr.find(".cellStagingProdID").val();
        //var quantity = tr.find(".cellQty").val();

        var lineItem = new Object();

        lineItem.LineNumber = tr.find(".cellLineNumber").html();
        lineItem.LineItemID = tr.find(".cellLineItemID").val();
        lineItem.ProductStagingID = tr.find(".cellStagingProdID").val();
        lineItem.ProductCode = $('#txtProdCode').val();
        lineItem.EANCode = $('#txtEANCode').val();
        lineItem.ShortDescription = $('#txtShortDesc').val();
        lineItem.LongDescription = $('#txtLongDesc').val();
        lineItem.UnitCost = $('#txtUnitCost').val();
        lineItem.Quantity = $('#txtQty').val();

        UpdateLineItem(lineItem);
    }

    function UpdateLineItem(lineItem) {

        var session = 'WMSSession.TempOutboundItemLine';

        var parameters = JSON.stringify({
            lineItem: lineItem,
            viewSession: session
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("EditableGrid_UpdateLineItem", "Outbound")',
            data: parameters,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

                $('#trLineEntry').find('input:text').val('');

                var templateContainer = $("#tblOrderLineItems tbody").empty();
                var json = { 'Records': result.Data };

                $("#tmplOrderLineItems").tmpl(json).appendTo(templateContainer);

                // Reapply plugins/bind controls
                EditableGridConfig();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    /* Save **********************************************************************************/
    function SaveLineItems() {

        var session = 'WMSSession.TempOutboundItemLine';

        var OrderID = OrderArray[0];

        var parameters = JSON.stringify({
            pOrderID: OrderID,
            pCustomerDetailID: gloCustomerDetailID,
            pCustomerID: gloCustomerID,
            pTable: tableArray.join(','),
            viewSession: session
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("UpdateOrderLine", "Outbound")',
            data: parameters,
            dataType: "json",
            success: function (result) {

                var result = result.Result;

                if (result.search(/error/i) == -1) {
                    // Clear all inputs in line entry
                    $('#trLineEntry').find('input:text').val('');
                    $('#txtProdCode').focus();

                    var templateContainer = $("#tblOrderLineItems tbody").empty();
                    var json = { 'Records': result.Data };

                    $("#tmplOrderLineItems").tmpl(json).appendTo(templateContainer);

                    // Reapply plugins/bind controls
                    EditableGridConfig();
                    $("#divSelectedCustomer").empty();
                    $("#divInvoiceCustomer").empty();
                    $("#divShippCustomer").empty();
                    window.location = "../Outbound/OutboundMain";
                }
                else {
                    swal(result);

                    $('#txtProdCode').focus();
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }


    /* jQuery UI Autocomplete **********************************************************************************/
    function BindAutocomplete() {
        $(".autocomplete").autocomplete({
            minLength: 3,
            source: function (request, response) {

                // 'this.element' - element the autocomplete widget is attached to
                var searchType = '';
                if ($(this.element).hasClass('cellProdCode')) {
                    searchType = 'ProdCode';
                }
                else if ($(this.element).hasClass('cellEANCode')) {
                    searchType = 'EANCode';
                }
                else if ($(this.element).hasClass('cellShortDesc')) {
                    searchType = 'ShortDesc';
                }
                else {
                    searchType = 'LongDesc';
                }

                $.ajax({
                    url: '@Url.Action("EditableGrid_ProductLookup", "Inbound")',
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ startsWith: request.term, searchType: searchType }),
                    success: function (data) {
                        response($.map(data, function (item) {

                            var label = '';
                            switch (searchType) {
                                case 'ProdCode':
                                    label = item.ProdCode;
                                    break;
                                case 'EANCode':
                                    label = item.EANCode;
                                    break;
                                case 'ShortDesc':
                                    label = item.ShortDesc; //(item.ShortDesc == null || item.ShortDesc == '') ? item.ProdCode : item.ShortDesc;
                                    break;
                                default:
                                    label = item.LongDesc;
                            }

                            return {
                                value: item.ProdCode,
                                label: label,
                                ProductStagingID: item.ProductStagingID,
                                ProdCode: item.ProdCode,
                                EANCode: item.EANCode,
                                ShortDesc: item.ShortDesc,
                                LongDesc: item.LongDesc,
                                UnitCost: item.UnitCost,
                                SalesPrice: item.SalesPrice

                            }
                        }));
                    },
                });
            },

            response: function (event, ui) {
                if (ui.content.length === 0) {
                    swal("No results found");
                }
            },
            focus: autocomplete_OnFocus,
            select: autocomplete_OnSelect
        });
    }
    function autocomplete_OnFocus(event, ui) {
        //$("#" + event.target.id).val(ui.item.value);

        var tr = $(this).closest('tr');

        tr.find(".cellStagingProdID").val(ui.item.ProductStagingID);
        tr.find(".cellProdCode").val(ui.item.ProdCode);
        tr.find(".cellEANCode").val(ui.item.EANCode);
        tr.find(".cellShortDesc").val(ui.item.ShortDesc);
        tr.find(".cellLongDesc").val(ui.item.LongDesc);
        tr.find(".cellUnitCost").val(ui.item.SalesPrice);

        // This is causing a selection as soon as an item has focus
        //tr.find(".cellQty").focus();

        return false;
    }
    function autocomplete_OnSelect(event, ui) {

        var match = false;
        var last = (parseInt($('#tblOrderLineItems tbody').children('tr').length) + 1);

        $('#tblOrderLineItems tr').each(function (i, row) {

            if ((i != 0) && (i != last)) {
                var $row = $(row), $ProductStagingID = $row.find('input[id*="txtProductStagingID"]');
                if ($ProductStagingID.val() == ui.item.ProductStagingID) {
                    match = true;
                }
            }
        });

        if (match == true) {
            swal("Product Has Already Been Added");

            $('#trLineEntry').find('input:text').val('');

        }
        else {
            $("#" + event.target.id).val(ui.item.value);

            var tr = $(this).closest('tr');

            tr.find(".cellStagingProdID").val(ui.item.ProductStagingID);
            tr.find(".cellProdCode").val(ui.item.ProdCode);
            tr.find(".cellEANCode").val(ui.item.EANCode);
            tr.find(".cellShortDesc").val(ui.item.ShortDesc);
            tr.find(".cellLongDesc").val(ui.item.LongDesc);
            tr.find(".cellUnitCost").val(ui.item.SalesPrice);

            var keyCode = event.keyCode || event.which;
            if (keyCode == 9) {
                $(this).last("input:text").focus().select();
            }
            else {
                tr.find(".cellQty").focus();
                //tr.find(".cellUnitCost").focus();
            }
        }
    }

    function CustomerNameAutoComplete() {

        var autoComplete,
             input = $("#txtReceiverName");

        // Initialize autocomplete
        input.autocomplete({
            autoFocus: true,
            focus: function (e, ui) {
                // To disable the Autocomplete changing the input text on mouseover/hover, simply return false from the focus callback
                return true;
            },

            open: function (event, ui) {
                $('.ui-autocomplete.ui-front').zIndex(10);
            },
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("OrderCustomerName_Lookup", "Outbound")',
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: "{ startsWith: '" + request.term + "' }",
                    success: function (data) {
                        response($.map(data, function (item) {

                            var label = '';
                            var value = '';

                            label = item.CustomerName + ", " + item.CustomerID + ", " + item.StoreCode + ", " + item.StreetAddress1 + ", " + item.StreetAddress2 + ", " + item.Suburb + ", " + item.TelephoneNo + ", " + item.CellNo;
                            value = item.CustomerID + "|" + item.CustomerDetailID + "|" + item.StoreCode + "|" + item.CustomerName + "|" + item.DefaultContactPerson + item.StreetAddress1 + "|" + item.StreetAddress2 + "|" +
                                    item.TelephoneNo + "|" + item.ZoneID + "|" + item.isActive + "|" + item.EmailAddress + "|" + item.Suburb + "|" + item.HubID + item.International + "|" + item.CellNo + "|" + item.FaxNo + "|" + item.PostalCode;

                            return {
                                value: value,
                                label: label,
                                CustomerName: item.CustomerName
                            }
                        }));
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        swal({
                            title: 'Error',
                            text: 'There was an error:' + errorThrown,
                            type: 'error',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#D42E12'
                        });
                    }
                });
            },

            response: function (event, ui) {
                if (ui.content.length === 0) {
                    swal("No Result");
                    $("#divSelectedCustomer").empty();
                    $("#divInvoiceCustomer").empty();
                    $("#divShippCustomer").empty();
                    
                }
            },

            select: function (event, ui) {
                customerArray = ui.item.value.split('|');
                $.trim($("#txtReceiverName").val(ui.item.CustomerName));
                FormatSessionDetails(customerArray);
                thisValidatedFormUpdateOrder.resetForm();
                $('#txtProdCode').focus();

                return false;
            }
        });

        // get reference to autocomplete element
        autoComplete = input.autocomplete("widget");
    }

    function FormatSessionDetails(d) {

        //Table Displays Selected Customer Detail
        $('#btnAddProduct').removeAttr("disabled", "disabled");
        $('#divSelectedCustomer').html('');
        $('#divSelectedCustomer').append('<table></table>');
        var $table = $('#divSelectedCustomer').children();

        var OrderID = OrderArray[0];
        var CustomerID = OrderArray[1];
        var CustomerName = OrderArray[3];
        var RAMOrderNumber = OrderArray[4];
        var DateCreated = OrderArray[5];
        var CustomerGroupID = OrderArray[6];

        $table.attr('class', 'table table-striped');

        $table.append($("<tr/>")
            .append($("<td/>").text('OrderID:')).append($("<td/>").text(OrderID)));
        $table.append($("<tr/>")
            .append($("<td/>").text('RAMOrderNumber:')).append($("<td/>").text(RAMOrderNumber)));
        $table.append($("<tr/>")
            .append($("<td/>").text('DateCreated:')).append($("<td/>").text(DateCreated)));
        $table.append($("<tr/>")
            .append($("<td/>").text('CustomerGroupID:')).append($("<td/>").text(CustomerGroupID)));
        $table.append($("<tr/>")
            .append($("<td/>").text('CustomerID:')).append($("<td/>").text(d[0])));
        $table.append($("<tr/>")
            .append($("<td/>").text('CustomerDetailID:')).append($("<td/>").text(d[1])));
        $table.append($("<tr/>")
            .append($("<td/>").text('StoreCode:')).append($("<td/>").text(d[2])));
        $table.append($("<tr/>")
            .append($("<td/>").text('CustomerName:')).append($("<td/>").text(d[3])));
        $table.append($("<tr/>")
            .append($("<td/>").text('DefaultContactPerson:')).append($("<td/>").text(d[4])));
        $table.append($("<tr/>")
            .append($("<td/>").text('StreetAddress1:')).append($("<td/>").text(d[5])));
        $table.append($("<tr/>")
            .append($("<td/>").text('StreetAddress2:')).append($("<td/>").text(d[6])));
        $table.append($("<tr/>")
            .append($("<td/>").text('TelephoneNo:')).append($("<td/>").text(d[7])));
        $table.append($("<tr/>")
            .append($("<td/>").text('ZoneID:')).append($("<td/>").text(d[8])));
        $table.append($("<tr/>")
            .append($("<td/>").text('isActive:')).append($("<td/>").text(d[9])));

        gloCustomerDetailID = d[1];
        gloCustomerID = d[0];
    }

    function FormatShippingDetails(d) {

        $('#txtInvoiceName').val(d[3]);
        //Table Displays Selected Customer Detail
        $('#btnAddProduct').removeAttr("disabled", "disabled");
        $('#divShippCustomer').html('');
        $('#divShippCustomer').append('<table></table>');

        var $table = $('#divShippCustomer').children();

        $table.attr('class', 'table table-striped');

        $table.append($("<tr/>")
            .append($("<td/>").text('Billing CustomerID:')).append($("<td/>").text(d[0])));
        $table.append($("<tr/>")
            .append($("<td/>").text('CustomerDetailID:')).append($("<td/>").text(d[1])));
        $table.append($("<tr/>")
            .append($("<td/>").text('StoreCode:')).append($("<td/>").text(d[2])));
        $table.append($("<tr/>")
            .append($("<td/>").text('CustomerName:')).append($("<td/>").text(d[3])));
        $table.append($("<tr/>")
            .append($("<td/>").text('DefaultContactPerson:')).append($("<td/>").text(d[4])));
        $table.append($("<tr/>")
            .append($("<td/>").text('StreetAddress1:')).append($("<td/>").text(d[5])));
        $table.append($("<tr/>")
            .append($("<td/>").text('StreetAddress2:')).append($("<td/>").text(d[6])));
        $table.append($("<tr/>")
            .append($("<td/>").text('TelephoneNo:')).append($("<td/>").text(d[7])));
        $table.append($("<tr/>")
            .append($("<td/>").text('ZoneID:')).append($("<td/>").text(d[8])));
        $table.append($("<tr/>")
            .append($("<td/>").text('isActive:')).append($("<td/>").text(d[9])));
    }

    function GetOrderDetail(pOrderID) {

        var parameters = JSON.stringify({
            OrderID: pOrderID
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetOrderDetail", "Outbound")',
            data: parameters,
            dataType: "json",
            success: function (response) {
                var result = response.Result;

                if (result.search(/error/i) == -1) {
                    if (response.RecordCount > 0) {
                        $.each(response.Data, function (index, value) {
                            DetailArray = value.CustomerDetail.split('|');
                            OrderArray = value.OrderCustomer.split('|');
 
                        });

                        $('#txtReceiverName').val(OrderArray[2]);
                        GetOrderBillingDetail(OrderArray[3]);
                        FormatSessionDetails(DetailArray);
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function GetOrderBillingDetail(pBillingCustomerID) {

        var parameters = JSON.stringify({
            CustomerID: pBillingCustomerID
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetCustomerDetail", "Outbound")',
            data: parameters,
            dataType: "json",
            success: function (response) {
                var result = response.Result;

                if (result.search(/error/i) == -1) {
                    if (response.RecordCount > 0) {
                        $.each(response.Data, function (index, value) {
                            DetailArray = value.CustomerDetail.split('|');
                        });
                        FormatShippingDetails(DetailArray);
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function IsUpdateOrderSaveValid() {
        var isFormValid = $("#formUpdateOrder").valid();
        return isFormValid;
    }

    function ConfigureOrderSaveValidation() {

        thisValidatedFormUpdateOrder = $("#formUpdateOrder").validate({
            onsubmit: true,
            rules: {
                txtReceiverName: {
                    required: true,
                    minlength: 3
                }
            },
            messages: {
                txtReceiverName: {
                    required: "Please enter a valid Customer ID or Customer Name",
                    minlength: "The customer name must consist of at least 3 characters"
                }
            }
        });
    }

    function SaveCustomer() {

        var customer = new Object();
        customer.CustomerID = $('#txtCustomerID').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');
        customer.CustomerGroup = $('#txtCustomerGroup').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');
        customer.StoreCode = $('#txtStoreCode').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');
        customer.CustomerGroupID = $('#hiddenCustomerGroupID').val();
        customer.CustomerName = $('#txtCustomerName').val();
        customer.TelephoneNo = $('#txtTelephone').val();
        customer.FaxNo = $('#txtFaxNo').val();
        customer.EmailAddress = $('#txtEmail').val();
        customer.StreetAddress1 = $('#txtStreetAddress1').val();
        customer.StreetAddress2 = $('#txtStreetAddress2').val();
        customer.ZoneID = $('#hiddenZoneID').val();
        customer.isShipper = 0;
        customer.isActive = 1;
        customer.EmployeeID = "";
        customer.TerminalID = "";
        customer.CellNo = $('#txtCellNo').val();
        customer.DefaultContactPerson = $('#txtDefaultContact').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');

        if (echeck($.trim($('#txtEmail').val())) == false) {
            $('#txtEmail').focus();
            swal("Invalid Shipping E-mail Address", "", "error");
            return;
        }

        var parameters = JSON.stringify({
            customer: customer
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("SaveCustomer", "MasterData")',
            data: parameters,
            dataType: "json",
            success: function (response) {

                var result = response.Result;
                var saveResponse = response.SaveResponse;
                ShippingCustomerID = (result.split(':'))[1];

                if (result.search(/error/i) == -1) {

                    var new_customerID = response.SaveResponse.CustomerID;

                    if (new_customerID != '') {
                        swal(result);
                        var chkShipBilling = $("#chkBilltoShip").is(':checked');

                        if (chkShipBilling == false) {
                            if ($('#txtCustomerIDBilling').val() != 'NEW') {
                                SaveBillingCustomerID(ShippingCustomerID, $('#txtCustomerIDBilling').val())
                            }
                            else if ($('#txtCustomerIDBilling').val() == 'NEW') {
                                if ($('#txtCustomerNameBilling').val() == '') {
                                    swal("Please Complete Billing Address Registration.","", "error");
                                    SaveBillingCustomer();
                                }
                                else {
                                    SaveBillingCustomer();
                                }
                            }
                        }
                        else {
                            //location.reload(true);
                            window.location.reload();
                        }
                    }
                    else {
                        swal("Unable to determine new CustomerID.", "", "error");
                    }
                }
                else {
                    swal(response.SaveResponse.Details);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function SaveBillingCustomer() {

        var customer = new Object();
        customer.CustomerID = $('#txtCustomerIDBilling').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');
        customer.CustomerGroup = $('#txtCustomerGroupBilling').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');
        customer.StoreCode = $('#txtStoreCodeBilling').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');
        customer.CustomerGroupID = $('#hiddenCustomerGroupID').val();
        customer.CustomerName = $('#txtCustomerNameBilling').val();
        customer.TelephoneNo = $('#txtTelephoneBilling').val();
        customer.FaxNo = $('#txtFaxNoBilling').val();
        customer.EmailAddress = $('#txtEmailBilling').val();
        customer.StreetAddress1 = $('#txtStreetAddress1Billing').val();
        customer.StreetAddress2 = $('#txtStreetAddress2Billing').val();
        customer.ZoneID = $('#hiddenBillingZoneID').val();
        customer.isShipper = 0;
        customer.isActive = 1;
        customer.EmployeeID = "";
        customer.TerminalID = "";
        customer.CellNo = $('#txtCellNoBilling').val();
        customer.DefaultContactPerson = $('#txtDefaultContactBilling').val().replace(/[!"#$%*+\/;<=>?[\\\]^`{|}~]/g, '');

        if (echeck($.trim($('#txtEmailBilling').val())) == false) {
            $('#txtEmailBilling').focus();
            swal("Invalid Billing E-mail Address","", "error");
            return;
        }

        var parameters = JSON.stringify({
            customer: customer
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("SaveCustomer", "MasterData")',
            data: parameters,
            dataType: "json",
            success: function (response) {
                var result = response.Result;
                var saveResponse = response.SaveResponse;
                swal('Billing' + result);
                BillingCustomerID = (result.split(':'))[1];
                SaveBillingCustomerID(ShippingCustomerID, BillingCustomerID);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function SaveBillingCustomerID(ShippingCustomerID, BillingCustomerID) {

        var parameters = JSON.stringify({
            pCustomerID: ShippingCustomerID,
            pBillingCustomerID: BillingCustomerID
        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("SaveBillingCustomerID", "MasterData")',
            data: parameters,
            dataType: "json",
            success: function (response) {
                var result = response.Result;
                if (result.search(/error/i) == -1) {
                    var info = 'Customer ID: ' + ShippingCustomerID + '\n' + 'Billing ID: ' + BillingCustomerID;
                }
                //location.reload(true);
                window.location.reload();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                swal({
                    title: 'Error',
                    text: 'There was an error:' + errorThrown,
                    type: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#D42E12'
                });
            }
        });
    }

    function ConfigureCustomerSaveValidation() {

        thisValidatedAddNewForm = $("#formShipping").validate({
            onsubmit: true,
            rules: {
                txtCustomerName: {
                    required: true,
                    minlength: 3
                },
                txtTelephone: {
                    required: true
                },
                txtEmail: {
                    required: true
                },
                hiddenZoneID: {
                    required: true
                },
                txtStreetAddress1: {
                    required: true
                },
                txtStreetAddress2: {
                    required: true
                },
                txtSuburb: {
                    required: true
                },
            },
            messages: {
                txtCustomerName: {
                    required: "Please enter a valid customer name",
                    minlength: "The customer name must consist of at least 3 characters",
                },
                txtTelephone: {
                    required: "Please enter a valid telephone number"
                },
                txtEmail: {
                    required: "Please enter a valid email address"
                },
                hiddenZoneID: {
                    required: "Please select a valid ZoneID"
                },
                txtStreetAddress1: {
                    required: "Please enter a valid Street Address 1"
                },
                txtStreetAddress2: {
                    required: "Please enter a valid Street Address 2"
                },
                txtSuburb: {
                    required: "Please enter a valid Suburb"
                },
            }
        });
    }

    function ConfigureCustomerBillingSaveValidation() {

        thisValidatedBillingForm = $("#formBilling").validate({
            onsubmit: true,
            rules: {
                txtCustomerNameBilling: {
                    required: true,
                    minlength: 3
                },
                txtTelephoneBilling: {
                    required: true
                },
                txtEmailBilling: {
                    required: true
                },
                hiddenZoneIDBilling: {
                    required: true
                },
                txtStreetAddress1Billing: {
                    required: true
                },
                txtStreetAddress2Billing: {
                    required: true
                },
                txtSuburbBilling: {
                    required: true
                },

            },
            messages: {
                txtCustomerNameBilling: {
                    required: "Please enter a valid customer name",
                    minlength: "The customer name must consist of at least 3 characters",
                },
                txtTelephoneBilling: {
                    required: "Please enter a valid telephone number"
                },
                txtEmailBilling: {
                    required: "Please enter a valid email address"
                },
                hiddenZoneIDBilling: {
                    required: "Please select a valid ZoneID"
                },
                txtStreetAddress1Billing: {
                    required: "Please enter a valid Street Address 1"
                },
                txtStreetAddress2Billing: {
                    required: "Please enter a valid Street Address 2"
                },
                txtSuburbBilling: {
                    required: "Please enter a valid Suburb"
                },
            }
        });

    }

    function IsCustomerSaveValid() {
        var isFormValid = $("#formShipping").valid();

        return isFormValid;
    }

    function IsCustomerSaveBillingValid() {
        var isBillingFormValid = $("#formBilling").valid();

        return isBillingFormValid;
    }

    function BillingSuburbLookup() {

        var autoComplete,
             dlg = $("#modalAddNew"),
             input = $("#txtSuburbBilling", dlg);

        // Initialize autocomplete
        input.autocomplete({
            autoFocus: true,
            focus: function (e, ui) {
                // To disable the Autocomplete changing the input text on mouseover/hover, simply return false from the focus callback
                return true;
            },
            appendTo: "#modalAddNew",
            open: function (event, ui) {
                var dialog = $(this).closest('#modalAddNew');
                if (dialog.length > 0) {
                    $('.ui-autocomplete.ui-front').zIndex(dialog.zIndex() + 10);
                }
            },
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("Suburb_Lookup", "MasterData")',
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: "{ startsWith: '" + request.term + "' }",
                    success: function (data) {
                        response($.map(data, function (item) {

                            var displayText = "";
                            if (item.Area != "")
                                displayText = item.Suburb + ", " + item.Area + ", " + item.PostalCode;
                            else
                                displayText = item.Suburb + ", " + item.PostalCode;

                            return {
                                value: item.Suburb,
                                label: displayText,
                                area: item.Area,
                                zoneid: item.ZoneID,
                                postalcode: item.PostalCode,
                                hubID: item.HubID,
                                international: item.International,
                                township: item.Township
                            }
                        }));
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        swal({
                            title: 'Error',
                            text: 'There was an error:' + errorThrown,
                            type: 'error',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#D42E12'
                        });
                    }
                });
            },
            focus: function (event, ui) {
                $("#" + event.target.id).val(ui.item.value);
                return false;
            },
            select: function (event, ui) {
                $("#" + event.target.id).attr('style', 'background-color:lightgreen;');
                $("#" + event.target.id).val(ui.item.value);
                $("#txtAreaBilling").val(ui.item.area);
                $("#txtPostalCodeBilling").val(ui.item.postalcode);
                $("#txtHubIDBilling").val(ui.item.hubID);
                $("#txtInternationalBilling").val(ui.item.international);
                $("#hiddenZoneID").val(ui.item.zoneid);

                var international = ui.item.international;
                // apply mask
                if (international == '1') {
                    $(".ContactNumbers").unmask();
                }
                else {
                    $(".ContactNumbers").mask("999 999 9999");
                }

                var divSuburbDetails = $('#divSuburbDetails');
                divSuburbDetails.css('display', 'none');

                return false;
            }
        });
        // get reference to autocomplete element
        autoComplete = input.autocomplete("widget");

        // init the dialog containing the input field
        dlg.modal({
            backdrop: 'static',
            keyboard: false
        });

        // move the autocomplete element after the dialog in the DOM
        autoComplete.insertAfter(dlg.parent());

    }

    function ConfigureAddNewModal() {

        $('#txtCustomerID').val("NEW");
        $('#txtCustomerName').val("")
        $('#txtStoreCode').val("");
        $('#txtDefaultContact').val("");
        $('#txtTelephone').val("");
        $('#txtSuburb').val("");
        $('#txtCustomerGroup').val("");
        $('#txtCellNo').val("");
        $('#txtFaxNo').val("");
        $('#txtEmail').val("");
        $('#txtStreetAddress1').val("");
        $('#txtStreetAddress2').val("");
        $('#txtSuburb').val("");
        $('#txtArea').val("");
        $('#txtPostalCode').val("");
        $('#txtHubID').val("");
        $('#txtInternational').val("");

        $('#hiddenAction').val('ADD');

        $('#txtCustomerIDBilling').val("NEW");
        $('#txtCustomerNameBilling').val("")
        $('#txtStoreCodeBilling').val("");
        $('#txtDefaultContactBilling').val("");
        $('#txtTelephoneBilling').val("");
        $('#txtSuburbBilling').val("");
        $('#txtCustomerGroupBilling').val("");
        $('#txtCellNoBilling').val("");
        $('#txtFaxNoBilling').val("");
        $('#txtEmailBilling').val("");
        $('#txtStreetAddress1Billing').val("");
        $('#txtStreetAddress2Billing').val("");
        $('#txtSuburbBilling').val("");
        $('#txtAreaBilling').val("");
        $('#txtPostalCodeBilling').val("");
        $('#txtHubIDBilling').val("");
        $('#txtInternationalBilling').val("");

        $('#txtCustomerIDBilling').attr("disabled", "disabled");
        $('#txtCustomerNameBilling').attr("disabled", "disabled");
        $('#txtStoreCodeBilling').attr("disabled", "disabled");
        $('#txtDefaultContactBilling').attr("disabled", "disabled");
        $('#txtTelephoneBilling').attr("disabled", "disabled");
        $('#txtSuburbBilling').attr("disabled", "disabled");
        $('#txtCustomerGroupBilling').attr("disabled", "disabled");
        $('#txtCellNoBilling').attr("disabled", "disabled");
        $('#txtFaxNoBilling').attr("disabled", "disabled");
        $('#txtEmailBilling').attr("disabled", "disabled");
        $('#txtStreetAddress1Billing').attr("disabled", "disabled");
        $('#txtStreetAddress2Billing').attr("disabled", "disabled");
        $('#txtSuburbBilling').attr("disabled", "disabled");
        $('#txtAreaBilling').attr("disabled", "disabled");
        $('#txtPostalCodeBilling').attr("disabled", "disabled");
        $('#txtHubIDBilling').attr("disabled", "disabled");
        $('#txtInternationalBilling').attr("disabled", "disabled");
        //$('#chkBilltoShip').attr("disabled", "disabled");
        $('#btnSaveBillingCustomer').attr("disabled", "disabled");

        // Set modal defaults
        $('#myModalLabel2').text('Add New Customer');
        $('button[data-dismiss]').last().text('Cancel');

        var autoComplete,
             dlg = $("#modalAddNew"),
             input = $("#txtSuburb", dlg);

        // Initialize autocomplete
        input.autocomplete({
            autoFocus: true,
            focus: function (e, ui) {
                // To disable the Autocomplete changing the input text on mouseover/hover, simply return false from the focus callback
                return true;
            },
            appendTo: "#modalAddNew",
            open: function (event, ui) {
                var dialog = $(this).closest('#modalAddNew');
                if (dialog.length > 0) {
                    $('.ui-autocomplete.ui-front').zIndex(dialog.zIndex() + 10);
                }
            },
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("Suburb_Lookup", "MasterData")',
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: "{ startsWith: '" + request.term + "' }",
                    success: function (data) {
                        response($.map(data, function (item) {

                            var displayText = "";
                            if (item.Area != "")
                                displayText = item.Suburb + ", " + item.Area + ", " + item.PostalCode;
                            else
                                displayText = item.Suburb + ", " + item.PostalCode;

                            return {
                                value: item.Suburb,
                                label: displayText,
                                area: item.Area,
                                zoneid: item.ZoneID,
                                postalcode: item.PostalCode,
                                hubID: item.HubID,
                                international: item.International,
                                township: item.Township
                            }
                        }));
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        swal({
                            title: 'Error',
                            text: 'There was an error:' + errorThrown,
                            type: 'error',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#D42E12'
                        });
                    }
                });
            },
            focus: function (event, ui) {
                $("#" + event.target.id).val(ui.item.value);
                return false;
            },
            select: function (event, ui) {
                $("#" + event.target.id).attr('style', 'background-color:lightgreen;');
                $("#" + event.target.id).val(ui.item.value);
                $("#txtArea").val(ui.item.area);
                $("#txtPostalCode").val(ui.item.postalcode);
                $("#txtHubID").val(ui.item.hubID);
                $("#txtInternational").val(ui.item.international);
                $("#hiddenZoneID").val(ui.item.zoneid);

                var international = ui.item.international;
                // apply mask
                if (international == '1') {
                    $(".ContactNumbers").unmask();
                }
                else {
                    $(".ContactNumbers").mask("999 999 9999");
                }

                var divSuburbDetails = $('#divSuburbDetails');
                divSuburbDetails.css('display', 'none');

                return false;
            }
        });
        // get reference to autocomplete element
        autoComplete = input.autocomplete("widget");

        // init the dialog containing the input field
        dlg.modal({
            backdrop: 'static',
            keyboard: false
        });

        // move the autocomplete element after the dialog in the DOM
        autoComplete.insertAfter(dlg.parent());
    }

    function chkBilling() {

        $('#chkBilltoShip').click(function () {

            if ($(this).is(':checked')) {

                $('#txtCustomerIDBilling').val($('#txtCustomerID').val());
                $('#txtCustomerNameBilling').val($('#txtCustomerName').val())
                $('#txtStoreCodeBilling').val($('#txtStoreCode').val());
                $('#txtDefaultContactBilling').val($('#txtDefaultContact').val());
                $('#txtTelephoneBilling').val($('#txtTelephone').val());
                $('#txtSuburbBilling').val($('#txtSuburb').val());
                $('#txtCustomerGroupBilling').val($('#txtCustomerGroup').val());
                $('#txtCellNoBilling').val($('#txtCellNo').val());
                $('#txtFaxNoBilling').val($('#txtFaxNo').val());
                $('#txtEmailBilling').val($('#txtEmail').val());
                $('#txtStreetAddress1Billing').val($('#txtStreetAddress1').val());
                $('#txtStreetAddress2Billing').val($('#txtStreetAddress2').val());
                $('#txtSuburbBilling').val($('#txtSuburb').val());
                $('#txtAreaBilling').val($('#txtArea').val());
                $('#txtPostalCodeBilling').val($('#txtPostalCode').val());
                $('#txtHubIDBilling').val($('#txtHub').val());
                $('#txtInternationalBilling').val($('#txtInternational').val());

                $('#txtCustomerIDBilling').attr("disabled", "disabled");
                $('#txtCustomerNameBilling').attr("disabled", "disabled");
                $('#txtStoreCodeBilling').attr("disabled", "disabled");
                $('#txtDefaultContactBilling').attr("disabled", "disabled");
                $('#txtTelephoneBilling').attr("disabled", "disabled");
                $('#txtSuburbBilling').attr("disabled", "disabled");
                $('#txtCustomerGroupBilling').attr("disabled", "disabled");
                $('#txtCellNoBilling').attr("disabled", "disabled");
                $('#txtFaxNoBilling').attr("disabled", "disabled");
                $('#txtEmailBilling').attr("disabled", "disabled");
                $('#txtStreetAddress1Billing').attr("disabled", "disabled");
                $('#txtStreetAddress2Billing').attr("disabled", "disabled");
                $('#txtSuburbBilling').attr("disabled", "disabled");
                $('#txtAreaBilling').attr("disabled", "disabled");
                $('#txtPostalCodeBilling').attr("disabled", "disabled");
                $('#txtHubIDBilling').attr("disabled", "disabled");
                $('#txtInternationalBilling').attr("disabled", "disabled");
                $('#btnSaveBillingCustomer').attr("disabled", "disabled");
            }
            else {

                //GetBillingDetail(gBillingID);

                $('#txtCustomerNameBilling').removeAttr("disabled", "disabled");
                $('#txtStoreCodeBilling').removeAttr("disabled", "disabled");
                $('#txtDefaultContactBilling').removeAttr("disabled", "disabled");
                $('#txtTelephoneBilling').removeAttr("disabled", "disabled");
                $('#txtSuburbBilling').removeAttr("disabled", "disabled");
                $('#txtCellNoBilling').removeAttr("disabled", "disabled");
                $('#txtFaxNoBilling').removeAttr("disabled", "disabled");
                $('#txtEmailBilling').removeAttr("disabled", "disabled");
                $('#txtStreetAddress1Billing').removeAttr("disabled", "disabled");
                $('#txtStreetAddress2Billing').removeAttr("disabled", "disabled");
                $('#txtSuburbBilling').removeAttr("disabled", "disabled");
                $('#btnSaveBillingCustomer').removeAttr("disabled", "disabled");
            }
        });
    }

    function echeck(str) {

        var at = "@@"
        var dot = "."
        var lat = str.indexOf(at)
        var lstr = str.length
        var ldot = str.indexOf(dot)
        if (str.indexOf(at) == -1) {
            return false
        }
        if (str.indexOf(at) == -1 || str.indexOf(at) == 0 || str.indexOf(at) == lstr) {
            return false
        }
        if (str.indexOf(dot) == -1 || str.indexOf(dot) == 0 || str.indexOf(dot) == lstr) {
            return false
        }
        if (str.indexOf(at, (lat + 1)) != -1) {
            return false
        }
        if (str.substring(lat - 1, lat) == dot || str.substring(lat + 1, lat + 2) == dot) {
            return false
        }
        if (str.indexOf(dot, (lat + 2)) == -1) {
            return false
        }
        if (str.indexOf(" ") != -1) {
            return false
        }
        return true
    }

    function CustomerNameBillingAutoComplete() {

        var customerArray = null;
        var autoComplete,
             dlg = $("#modalAddNew"),
             input = $("#txtCustomerNameBilling", dlg);

        // Initialize autocomplete
        input.autocomplete({
            autoFocus: true,
            focus: function (e, ui) {
                // To disable the Autocomplete changing the input text on mouseover/hover, simply return false from the focus callback
                return true;
            },
            appendTo: "#modalAddNew",
            open: function (event, ui) {
                var dialog = $(this).closest('#modalAddNew');
                if (dialog.length > 0) {
                    $('.ui-autocomplete.ui-front').zIndex(dialog.zIndex() + 10);
                }
            },
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("OrderCustomerName_Lookup", "Outbound")',
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: "{ startsWith: '" + request.term + "' }",
                    success: function (data) {
                        response($.map(data, function (item) {

                            var label = '';

                            label = item.CustomerName + ", " + item.CustomerID + ", " + item.StoreCode + ", " + item.StreetAddress1 + ", " + item.StreetAddress2 + ", " + item.Suburb + ", " + item.TelephoneNo + ", " + item.CellNo;

                            return {
                                value: item.CustomerID,
                                label: label,
                                CustomerID: item.CustomerID,
                                CustomerName: item.CustomerName,
                                BillingCustomerID: item.BillingCustomerID,
                                CustomerDetailID: item.CustomerDetailID,
                                StoreCode: item.StoreCode,
                                DefaultContactPerson: item.DefaultContactPerson,
                                StreetAddress1: item.StreetAddress1,
                                StreetAddress2: item.StreetAddress2,
                                TelephoneNo: item.TelephoneNo,
                                ZoneID: item.ZoneID,
                                isActive: item.isActive,
                                EmailAddress: item.EmailAddress,
                                Suburb: item.Suburb,
                                HubID: item.HubID,
                                International: item.International,
                                CellNo: item.CellNo,
                                FaxNo: item.FaxNo,
                                PostalCode: item.PostalCode
                            }
                        }));
                    },

                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        swal({
                            title: 'Error',
                            text: 'There was an error:' + errorThrown,
                            type: 'error',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#D42E12'
                        });
                    }
                });
            },

            select: function (event, ui) {

                $.trim($("#txtCustomerNameBilling").val(ui.item.CustomerName));
                $.trim($("#txtCustomerIDBilling").val(ui.item.CustomerID));
                $.trim($("#txtCustomerGroupBilling").val(''));
                $.trim($("#txtStoreCodeBilling").val(ui.item.StoreCode));
                $.trim($("#txtDefaultContactBilling").val(ui.item.DefaultContactPerson));
                $.trim($("#txtStreetAddress1Billing").val(ui.item.StreetAddress1));
                $.trim($("#txtStreetAddress2Billing").val(ui.item.StreetAddress2));
                $.trim($("#txtTelephoneBilling").val(ui.item.TelephoneNo));
                $.trim($("#txtEmailBilling").val(ui.item.EmailAddress));
                $.trim($("#txtSuburbBilling").val(ui.item.Suburb));
                $.trim($("#txtAreaBilling").val(''));
                $.trim($("#txtHubIDBilling").val(ui.item.HubID));
                $.trim($("#txtInternationalBilling").val(ui.item.International));
                $.trim($("#txtCellNoBilling").val(ui.item.CellNo));
                $.trim($("#txtFaxNoBilling").val(ui.item.FaxNo));
                $.trim($("#txtPostalCodeBilling").val(ui.item.PostalCode));
                $('#btnSaveBillingCustomer').removeAttr("disabled", "disabled");
                return false;
            }
        });

        // get reference to autocomplete element
        autoComplete = input.autocomplete("widget");

        // init the dialog containing the input field
        dlg.modal({
            backdrop: 'static',
            keyboard: false
        });

        // move the autocomplete element after the dialog in the DOM
        autoComplete.insertAfter(dlg.parent());
    }

</script>

<script id="tmplOrderLineItems" type="text/x-jQuery-tmpl">
    {{each(i,record) Records}}
    <tr class="lineItem">
        <td class="cellLineNumber" disabled>${record.LineNumber}</td>
        <td><input id="txtLineItemID${record.LineItemID}" type="text" class="cellLineItemID" value="${record.LineItemID}" disabled /></td>
        <td><input id="txtProductStagingID${record.ProductStagingID}" type="text" class="cellStagingProdID" value="${record.ProductStagingID}" disabled /></td>
        <td><input id="txtProdCode${record.ProductStagingID}" type="text" class="cellProdCode autocomplete" value="${record.ProductCode}" /></td>
        <td><input id="txtEANCode${record.ProductStagingID}" type="text" class="cellEANCode autocomplete" value="${record.EANCode}" /></td>
        <td><input id="txtShortDesc${record.ProductStagingID}" type="text" class="cellShortDesc autocomplete" value="${record.ShortDescription}" /></td>
        <td><input id="txtLongDesc${record.ProductStagingID}" type="text" class="cellLongDesc autocomplete" value="${record.LongDescription}" /></td>
        <td><input id="txtUnitCost${record.UnitCost}" type="text" class="cellUnitCost numeric" value="${record.UnitCost}" disabled /></td>
        <td><input id="txtQty${record.ProductStagingID}" type="text" class="cellQty numeric" value="${record.Quantity}" /></td>
        <td><input type="button" value="Delete" class="deleteRow" /></td>
        <td></td>
    </tr>
    {{/each}}
</script>

<script id="tmplViewOrderLineItems" type="text/x-jQuery-tmpl">
    {{each(i,record) Records}}
    <tr class="lineItem">
        <td class="cellLineNumber" disabled>${record.LineNumber}</td>
        <td><input id="txtLineItemID${record.LineItemID}" type="text" class="cellLineItemID" value="${record.LineItemID}" disabled /></td>
        <td><input id="txtProductStagingID${record.ProductStagingID}" type="text" class="cellStagingProdID" value="${record.ProductStagingID}" disabled /></td>
        <td><input id="txtProdCode${record.ProductStagingID}" type="text" class="cellProdCode autocomplete" value="${record.ProductCode}" disabled /></td>
        <td><input id="txtEANCode${record.ProductStagingID}" type="text" class="cellEANCode autocomplete" value="${record.EANCode}" disabled /></td>
        <td><input id="txtShortDesc${record.ProductStagingID}" type="text" class="cellShortDesc autocomplete" value="${record.ShortDescription}" disabled /></td>
        <td><input id="txtLongDesc${record.ProductStagingID}" type="text" class="cellLongDesc autocomplete" value="${record.LongDescription}" disabled /></td>
        <td><input id="txtUnitCost${record.UnitCost}" type="text" class="cellUnitCost numeric" value="${record.UnitCost}" disabled /></td>
        <td><input id="txtQty${record.ProductStagingID}" type="text" class="cellQty numeric" value="${record.Quantity}" disabled /></td>
        <td><input type="button" value="Remove" class="deleteRow" disabled /></td>

        <td></td>
    </tr>
    {{/each}}
</script>

@*https://www.simple-talk.com/dotnet/.net-framework/-client-side-markup-with-jquery-cloning-and-templates/*@
@*https://github.com/BorisMoore/jsrender*@
@*http://www.jsviews.com/#jsviews*@